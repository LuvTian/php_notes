#!/bin/sh
SOURCEIP=$(ip addr | grep inet | grep venet | grep -v 127.0.0.1 | awk '{print $2}' | awk -F '/' '{print $1}' | tr -d "." | tr -d "0")
SSH_PORT=$(echo ${SOURCEIP:0-4:4})
if [ -z "`grep ^Port /etc/ssh/sshd_config`" -a "$SSH_PORT" != '22' ];then
    sed -i "s@^#Port.*@&\nPort $SSH_PORT@" /etc/ssh/sshd_config
elif [ -n "`grep ^Port /etc/ssh/sshd_config`" ];then
    sed -i "s@^Port.*@Port $SSH_PORT@" /etc/ssh/sshd_config
fi
service sshd restart
service ssh restart