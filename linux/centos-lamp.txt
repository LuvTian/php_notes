1、配置防火墙，开启80端口、3306端口
vi /etc/sysconfig/iptables 添加下面两行：

-A INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT

-A INPUT -m state --state NEW -m tcp -p tcp --dport 3306 -j ACCEPT

:wq! #保存退出

/etc/init.d/iptables restart    或者service iptables restart   #重启防火墙使配置生效

2、关闭SELINUX

vi /etc/selinux/config

#SELINUX=enforcing #注释掉

#SELINUXTYPE=targeted #注释掉

SELINUX=disabled #增加

:wq! #保存退出
setenforce 0 #使配置立即生效

3、更换第三方yum源（http://mirrors.aliyun.com/)
第一步：备份你的原镜像文件，以免出错后可以恢复。
mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup
第二步：下载新的CentOS-Base.repo 到/etc/yum.repos.d/
CentOS 5
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-5.repo
CentOS 6
wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo
第三步：运行yum makecache生成缓存
yum clean all   #清除当前yum缓存
yum makecache   #缓存yum源中的软件包信息
yum repolist    #列出yum源中可用的软件包

接下安装配置lamp，注意yum update是安装所有更新软件，我们一般不需要安装所有，所以用yum install <package_name>来安装指定的软件

4、安装apache
yum install httpd #根据提示，输入Y安装即可成功安装

/etc/init.d/httpd start #启动Apache
service httpd restart #重启Apache
备注：Apache启动之后会提示错误：

httpd:httpd: Could not reliably determine the server's fully qualif domain name, using ::1 for ServerName

解决办法：

vi /etc/httpd/conf/httpd.conf #编辑

ServerName www.example.com:80 #去掉前面的注释

:wq! #保存退出

chkconfig httpd on #设为开机启动

/etc/init.d/httpd restart #重启Apache



5、安装MySQL
yum install mysql mysql-server #询问是否要安装，输入Y即可自动安装,直到安装完成

/etc/init.d/mysqld start #启动MySQL

# service mysqld restart 重启mysql

chkconfig mysqld on #设为开机启动

cp /usr/share/mysql/my-medium.cnf /etc/my.cnf #拷贝配置文件（注意：如果/etc目录下面默认有一个my.cnf，直接覆盖即可）

为root账户设置密码：

mysql_secure_installation

回车，根据提示输入Y

输入2次密码，回车

根据提示一路输入Y
Remove anonymous users? 是否删除匿名用户,生产环境建议删除，所以输入y并回车
Disallow root login remotely? 是否禁止root远程登录，我选择不禁止
Remove test database and access to it? 是否删除test数据库，可以删除
Reload privilege tables now?  是否重新加载权限表 y
最后出现：Thanks for using MySQL!

MySql密码设置完成，重新启动 MySQL：

/etc/init.d/mysqld restart #重启

/etc/init.d/mysqld stop #停止

/etc/init.d/mysqld start #启动

mysql -u root -p 进入mysql操作


update user set host ='%' where host='127.0.0.1';   （mysql remote access）修改数据库连接权限，让navicat可以进行远程连接
或者
update user set host='%' where user='root' and host='localhost';
flush privileges; #刷新权限表，使配置生效


6、安装PHP

yum install php #根据提示输入Y直到安装完成

安装PHP组件，使PHP支持MySQL：

yum install php-mysql php-gd libjpeg* php-imap php-ldap php-odbc php-pear php-xml php-xmlrpc php-mbstring php-mcrypt php-bcmath php-mhash libmcrypt

这里选择以上安装包进行安装

根据提示输入Y回车

/etc/init.d/mysqld restart #重启MySql

/etc/init.d/httpd restart #重启Apche

7、Apache配置
vi /etc/httpd/conf/httpd.conf #编辑文件

ServerTokens OS　 在44行 修改为：ServerTokens Prod （在出现错误页的时候不显示服务器操作系统的名称）

ServerSignature On　 在536行 修改为：ServerSignature Off （在错误页中不显示Apache的版本）

Options Indexes FollowSymLinks　 在331行 修改为：Options Includes ExecCGI FollowSymLinks（允许服务器执行CGI及SSI，禁止列出目录）

#AddHandler cgi-script .cgi　在796行 修改为：AddHandler cgi-script .cgi .pl （允许扩展名为.pl的CGI脚本运行）

AllowOverride None　 在338行 修改为：AllowOverride All （允许.htaccess）

AddDefaultCharset UTF-8　在759行 修改为：AddDefaultCharset GB2312　（添加GB2312为默认编码）

Options Indexes MultiViews FollowSymLinks  在554行 修改为 Options MultiViews FollowSymLinks（不在浏览器上显示树状目录结构）

DirectoryIndex index.html index.html.var  在402行 修改为：DirectoryIndex index.html index.htm Default.html Default.htm

index.php Default.php index.html.var （设置默认首页文件，增加index.php）

KeepAlive Off  在76行 修改为：KeepAlive On （允许程序性联机）

MaxKeepAliveRequests 100  在83行 修改为：MaxKeepAliveRequests 1000 （增加同时连接数）

:wq! #保存退出

/etc/init.d/httpd restart #重启

rm -f /etc/httpd/conf.d/welcome.conf /var/www/error/noindex.html #删除默认测试页

8、php配置
vi /etc/php.ini #编辑

date.timezone = PRC #在946行 把前面的分号去掉，改为date.timezone = PRC

disable_functions = passthru,exec,system,chroot,scandir,chgrp,chown,shell_exec,proc_open,proc_get_status,ini_alter,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru,stream_socket_server,escapeshellcmd,dll,popen,disk_free_space,checkdnsrr,checkdnsrr,getservbyname,getservbyport,disk_total_space,posix_ctermid,posix_get_last_error,posix_getcwd, posix_getegid,posix_geteuid,posix_getgid, posix_getgrgid,posix_getgrnam,posix_getgroups,posix_getlogin,posix_getpgid,posix_getpgrp,posix_getpid, posix_getppid,posix_getpwnam,posix_getpwuid, posix_getrlimit, posix_getsid,posix_getuid,posix_isatty, posix_kill,posix_mkfifo,posix_setegid,posix_seteuid,posix_setgid, posix_setpgid,posix_setsid,posix_setuid,posix_strerror,posix_times,posix_ttyname,posix_uname

#在386行 列出PHP可以禁用的函数，如果某些程序需要用到这个函数，可以删除，取消禁用。

expose_php = Off  #在432行 禁止显示php版本的信息

magic_quotes_gpc = On  #在745行 打开magic_quotes_gpc来防止SQL注入

short_open_tag = ON  #在229行支持php短标签

open_basedir = .:/tmp/  #在380行 设置表示允许访问当前目录(即PHP脚本文件所在之目录)和/tmp/目录,可以防止php木马跨站,如果改了之后安装程序有问题(例如：织梦内容管理系统)，可以注销此行，或者直接写上程序的目录/data/www.rehack.cn/:/tmp/

:wq! #保存退出

/etc/init.d/mysqld restart #重启MySql

/etc/init.d/httpd restart #重启Apche


9、测试
注意：apache默认的程序目录是/var/www/html

权限设置：chown apache.apache -R /var/www/html

在/var/www/html下新建index.php文件,内容为：
<?php
echo mysql_connect("localhost","root","123456")?"数据库连接成功":"数据库连接失败";
phpinfo();
?>

在浏览器通过ip地址访问

10.CentOS Apache搭建虚拟主机(配置多站点)，有基于域名、基于端口、基于ip的三种方式，这里介绍基于域名的方式：

需要两个域名解析到你的服务器，对应关系是
/var/www/site1              site1.com
/var/www/site2              site2.com
mkdir -p /var/www/{site1,site2} 可以通过集合方式创建目录
分别给这两个网站目录添加index.html文件:
echo "<h1>site1</h1>" >/var/www/site1/index.html
echo "<h1>site2</h1>" >/var/www/site2/index.html

接下来我们编辑一个配置文件（同一个IP的务必写在一个一个文件内）
#vi /etc/httpd/conf.d/virtual.conf
内容如下
NameVirtualHost 192.168.2.101:80
<VirtualHost 192.168.2.101:80>
    ServerName vm1.com
    DocumentRoot /var/www/site1
    ErrorLog logs/site1.com-error_log
    CustomLog logs/site1.com-access_log common
</VirtualHost>
<VirtualHost 192.168.2.101:80>
    ServerName vm2.com
    DocumentRoot /var/www/site2
    ErrorLog logs/site2.com-error_log
    CustomLog logs/site2.com-access_log common
</VirtualHost>
重启Apache # service httpd start

如果你没有DNS你可以再你的机器上hosts文件里加记录
linux在/etc/hosts这个文件
windows在C:\windows\system32\drivers\etc\hosts文件加上这两行
192.168.2.101    site1.com
192.168.2.101    site2.com

ps:
如果是基于ip虚拟主机，则ServerName直接设置成ip
如果是基于端口的虚拟主机,则VirtualHost ip后面需要加上:端口号，并且不需要ServerName这一项
<VirtualHost 192.168.2.101:81>
    DocumentRoot /var/www/site3
    ErrorLog logs/site3.com-error_log
    CustomLog logs/site3.com-access_log common
</VirtualHost>
新的端口号需要配置下防火墙 /etc/sysconfig/iptables

